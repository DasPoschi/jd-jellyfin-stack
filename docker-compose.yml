version: "3.8"

services:
  jdownloader:
    image: jlesage/jdownloader-2:latest
    container_name: jdownloader-2
    restart: unless-stopped
    ports:
      - "5800:5800"
    environment:
      TZ: "Europe/Berlin"
    volumes:
      - ./data/jd-config:/config
      - ./data/jd-output:/output

  jd-webgui:
    build: ./jd-webgui
    container_name: jd-webgui
    restart: unless-stopped
    depends_on:
      - jdownloader
    ports:
      - "8080:8080"
    environment:
      # MyJDownloader
      MYJD_EMAIL: "DEINE_EMAIL"
      MYJD_PASSWORD: "DEIN_MYJD_PASSWORT"
      MYJD_DEVICE: "DEIN_DEVICE_NAME"

      # Jellyfin VM SSH target
      JELLYFIN_HOST: "192.168.1.1"
      JELLYFIN_PORT: "22"
      JELLYFIN_USER: "jellyfinuser"
      JELLYFIN_SSH_KEY: "/ssh/id_ed25519"

      # Ziele (empfohlen getrennt; falls leer -> fallback auf DEST_DIR)
      JELLYFIN_MOVIES_DIR: "/srv/media/movies/inbox"
      JELLYFIN_SERIES_DIR: "/srv/media/series/inbox"
      # Fallback:
      JELLYFIN_DEST_DIR: "/srv/media/movies/inbox"

      POLL_SECONDS: "5"

      # Optional Basic Auth (leer = aus)
      BASIC_AUTH_USER: "admin"
      BASIC_AUTH_PASS: "CHANGE_ME"

        # Jellyfin API (für Rescan)
      JELLYFIN_API_BASE: "http://192.168.1.1:8096"
      JELLYFIN_API_KEY: "DEIN_JELLYFIN_API_KEY"
      JELLYFIN_LIBRARY_REFRESH: "true"   # true/false

      # TMDB (für Umbenennung)
      TMDB_API_KEY: "DEIN_TMDB_API_KEY"
      TMDB_LANGUAGE: "de-DE"             # optional, z.B. de-DE oder en-US

      # Zielstruktur
      CREATE_MOVIE_FOLDER: "true"        # pro Film Unterordner
      CREATE_SERIES_FOLDERS: "true"      # /Serien/Show/Season xx/

      # MD5 Sidecars nicht in /output schreiben
      MD5_DIR: "/md5"

    volumes:
      # Muss identisch zum JD Mount sein, damit /output stimmt
      - ./data/jd-output:/output:ro
      - ./data/md5:/md5:rw

      # SSH Key für Upload zur Jellyfin-VM
      - ~/.ssh/id_ed25519:/ssh/id_ed25519:ro
